syntax = "proto3";

package auth;

option go_package = "auth/grpc/api";

// 認証サービス
service AuthService {
  rpc Register(RegisterRequest) returns (RegisterResponse);
  rpc RegisterGoogle(RegisterGoogleRequest) returns (RegisterGoogleResponse);

  rpc VerifyEmail(VerifyEmailRequest) returns (VerifyEmailResponse);
  rpc VerifyToken(VerifyTokenRequest) returns (VerifyTokenResponse);
  rpc RequestPasswordReset(RequestPasswordResetRequest) returns (RequestPasswordResetResponse);
  rpc ResetPassword(ResetPasswordRequest) returns (ResetPasswordResponse);
  rpc ResendVerificationEmail(ResendVerificationEmailRequest) returns (ResendVerificationEmailResponse);

  rpc Login(LoginRequest) returns (LoginResponse);
  rpc LinkGoogle(LinkGoogleRequest) returns (LinkGoogleResponse);
}

// ユーザー登録リクエスト
message RegisterRequest {
  string email = 1;
  string password = 2;
  string name = 3;
}

// ユーザー登録レスポンス
message RegisterResponse {
  string user_id = 1;
}

// メールアドレス認証リクエスト
message VerifyEmailRequest {
  string token = 1;
}

// メールアドレス認証レスポンス
message VerifyEmailResponse {
}

// ログインリクエスト
message LoginRequest {
  string email = 1;
  string password = 2;
}

// ログインレスポンス
message LoginResponse {
  string access_token = 1;
  string refresh_token = 2;
  User user = 3;
}

// トークン検証リクエスト
message VerifyTokenRequest {
  string token = 1;
}

// トークン検証レスポンス
message VerifyTokenResponse {
  string user_id = 1;
  string email = 2;
  string name = 3;
}

// パスワードリセット要求リクエスト
message RequestPasswordResetRequest {
  string email = 1;
}

// パスワードリセット要求レスポンス
message RequestPasswordResetResponse {
}

// パスワードリセットリクエスト
message ResetPasswordRequest {
  string token = 1;
  string new_password = 2;
}

// パスワードリセットレスポンス
message ResetPasswordResponse {
}

// 認証確認メール再送リクエスト
message ResendVerificationEmailRequest {
  string email = 1;
}

// 認証確認メール再送レスポンス
message ResendVerificationEmailResponse {
}

// Googleアカウント登録リクエスト
message RegisterGoogleRequest {
  string google_id_token = 1;
  string name = 2; // 必要に応じてGoogleプロフィールから取得した名前で上書き
}

// Googleアカウント登録レスポンス
message RegisterGoogleResponse {
  string user_id = 1;
  string access_token = 2;
  string refresh_token = 3;
  User user = 4;
  bool is_new_user = 5; // 新規ユーザーかどうか
}

// Googleアカウント連携リクエスト
message LinkGoogleRequest {
  string access_token = 1; // 既存ユーザーのアクセストークン
  string google_id_token = 2;
}

// Googleアカウント連携レスポンス
message LinkGoogleResponse {
  User user = 2;
}

// ユーザー情報
message User {
  string id = 1;
  string email = 2;
  string name = 3;
  bool email_verified = 4;
  string created_at = 5;
  string updated_at = 6;
}
